{"entry_id": "http://arxiv.org/abs/2303.07097v1", "published": "20230313133743", "title": "Layers and stability", "authors": ["J. F. Jardine"], "primary_category": "math.AT", "categories": ["math.AT", "62R40 (Primary) 55U10, 68T09 (Secondary)"], "text": "\n\n\n\n\nDepartment of Mathematics\nUniversity of Western Ontario\n\n  London, Ontario, Canada\n\njardine@uwo.ca\n\n\n\nLayers and stability\n    J.F. JardineSupported by NSERC.\n    \n===================================\n\n\n\n\n  The hierarchy associated to clusters in the HDBSCAN algorithm has layers, which are defined by cardinality. The layers define a layer subposet of the HDBSCAN hierarchy, which is a strong deformation retract and admits a stability analysis. That stability analysis is introduced here. Cardinality arguments lead to sharper results for layers than one sees for stability statements for branch points.\n\n  This paper appeared on the author's website in January, 2021.\n\n\n\n\n\n\u00a7 INTRODUCTION\n\n\nEvery finite metric space X=(X,d) has an associated system of partially ordered sets P_s(X), where s is a non-negative real number. This system is filtered by the systems P_s,k(X) where k is a positive integer.\n\nThe poset P_s(X) consists of those subsets \u03c3 of X such that d(x,y) \u2264 s for all x,y \u2208\u03c3.\n\nThe poset P_s,k(X) consists of those subsets \u03c4 of X such that each x \u2208\u03c4 has at least k distinct neighbours y \u2208 X such that d(x,y) \u2264 s. We also require that d(x,x') \u2264 s for any two members x,x' of \u03c4.\n\nThe poset P_s(X) is the poset of simplices for the Vietoris-Rips complex V_s(X), and the poset P_s,k(X) is the poset of simplices of the degree Rips comples L_s,k(X).\n\nObserve that P_s,0(X) = P_s(X), so that the complex L_s,0(X) is the Vietoris-Rips complex V_s(X).\n\n\nFor a fixed density parameter k, the path component functor \u03c0_0 defines an assignment s \u21a6\u03c0_0L_s,k(X), giving a functor defined on the poset [0,\u221e] that takes values in sets.  The sets of path components \u03c0_0L_s,k(X) are commonly called clusters.\n\nThis functor defines a graph \u0393_k(X), with vertices consisting of pairs (s,[x]) with [x] \u2208\u03c0_0L_s,k(X). There is an edge (s,[x]) \u2192 (t,[y]) if s \u2264 t and [x]=[y] in \u03c0_0L_t,k(X). This graph is a hierarchy, or tree, which is commonly called the HDBSCAN hierarchy. It is also a poset because the edges can be composed, and this poset has a terminal object. I write (s,[x]) \u2264 (t,[y]) for edges (or morphisms) of \u0393_k(X) to reflect the poset structure.\n\nA vertex (s,[x]) of \u0393_k(X) is a branch point if either (s,[x]) has no antecedents (t,[y]) \u2264 (s,[x]), or if (s,[x]) has distinct antecedents (t,[y_1]) and (t,[y_2]) for sufficiently close t < s.\n\nA vertex (t,[y]) is a layer point if it has no antecedents, or if for all antecedents (s,[z]) \u2264 (t,[y]) with s < t, the set [z] is strictly smaller than [y] as a subset of X.\n\nEvery branch point is a layer point, but the converse assertion does not hold in general.\nLayer points and branch points do coincide for the Vietoris-Rips system V_s(X) = L_s,0(X), since the underlying system of vertex sets is constant.\n\n\nThe branch points and layer points, respectively, define subposets _k(X) and \u0141_k(X) of the tree \u0393_k(X), and there are poset inclusions\n\n    _k(X) \u2286\u0141_k(X) \u2282\u0393_k(X).\n\nThese subposets are themselves hierarchies.\n\nThe purpose of this note is to describe stability properties of the layer poset \u0141_k(X). There is a similar investigation of stability properties of branch points in <cit.> \u2014 the posets _k(X) of branch points and \u0141_k(X) of layer points have similar properties, but the cardinality counts associated with layer points are sharper tools. \n\n\nThe first section of this paper establishes the formal properties of the poset L_k(X) of layer points. The most important feature of L_k(X) is that it has a calculus of least upper bounds (Lemma <ref>), which mirrors the theory of least upper bounds for the branch point poset _k(X) that appears in <cit.>. The inclusion _k(X) \u2282 L_k(X) preserves least upper bounds. The poset morphisms\n\n    _k(X) \u2286 L_k(X) \u2282\u0393_k(X)\n\ndefine both _k(X) and \u0141_k(X) as strong deformation retracts of the poset \u0393_k(X), in a way that is consistent with the inclusion _k(X) \u2282 L_k(X) \u2014 see Lemma <ref> and Lemma <ref>. The retraction map max: \u0393_k(X) \u2192 L_k(X) is defined by setting max(t,[x]) to be the maximal layer point below (t,[x]). The layer point max(t,[x]) can also be defined to be the minimal point (s,[z]) \u2264 (t,[x]) such that [z]=[x] as subsets of the set X.\n\n\nIf i: X \u2282 Y is an inclusion of finite metric spaces, then there is an induced poset map i_\u2217: L_k(X) \u2192 L_k(Y), where i_\u2217(t,[x]) is defined to be the maximal layer point below (t,[i(x)]) in \u0393_k(Y). \n\nThe degree Rips stability theorem (Theorem 4 of <cit.>) says that there are homotopy commutative diagrams\n\n    L_s,k(X) [r]^\u03c3[d]_i    L_s+2r,k(X) [d]^i\n    \n        L_s,k(Y) [r]_\u03c3[ur]^\u03b8    L_s+2r,k(Y)\n\nin the presence of a condition d_H(X^k_dis,Y^k_dis) < r on Hausdorff distance between spaces of k+1 distinct points in X and Y.\nTheorem <ref> of Section 2 says that the diagram (<ref>) induces a homotopy commutative diagram\n\n    L_k(X) [r]^\u03c3_\u2217[d]_i_\u2217    L_k(X) [d]^i_\u2217\n    \n        L_k(Y) [r]_\u03c3_\u2217[ur]^\u03b8_\u2217    L_k(Y)\n\nThe map i_\u2217 in (<ref>) has already been defined, and all other maps in (<ref>) are defined analogously. For example, the shift homomorphism \u03c3_\u2217 is defined, for a layer point (t,[x]), by taking \u03c3_\u2217(t,[x]) to be the maximal layer point below (t+2r,[x]). The homotopy commutativity of (<ref>) amounts to the existence of natural relations\n\n    \u03b8_\u2217\u00b7 i_\u2217\u2264\u03c3_\u2217 and i_\u2217\u00b7\u03b8_\u2217\u2264\u03c3_\u2217.\n\n\nThese relations have to be interpreted a bit carefully. If, for example, (s.[x]) is a layer point of \u0393_k(X), then (t,[x]) is a layer point below (t+2r,[x]) so that (t,[x]) \u2264\u03c3_\u2217(t,[x]). This means that \u03c3_\u2217(t,[x]) is a common upper bound for (t,[x]) and \u03b8_\u2217i_\u2217(t,[x]), while \u03c3_\u2217(t,[x]) has the form (u,[x]) for some parameter value t \u2264 u \u2264 t+2r.\n\nI have not yet found a good way to estimate the corresponding parameter value of \u03b8_\u2217i_\u2217(t,[x]) without some extra assumptions. At this level of generality, we have the same issues with locating parameter values for the points i_\u2217(t,[x]) and \u03b8_\u2217(s,[y]), relative to t and s, respectively.\n\n\nWe can sharpen these relations if the layer points are sufficiently sparse. The layer parameters are the parameters t associated to the layer points (t,[x]) of \u0393_k(X). A layer parameter t can have a successor t_+ and a predecessor t_-. Lemma <ref> of this paper says that, if r < t < t_+-2r, then i_\u2217(t,[x]) = (s,[y]), where t-2r \u2264 s \u2264 t.\nUnder the same assumptions, Corollary <ref> further says that \u03b8_\u2217i_\u2217(t,[x]) = (t,[x]).\n\n\nLemma <ref> and Corollary <ref> deal with layer points (t,[x]) of \u0393_k(X) which have enough room \u201cabove\u201d them.\nIf r is sufficiently small such that r < t < t_+-2r for all layer parameters t of X, then \u03b8_\u2217i_\u2217(t,[x]) = (t,[x]) for all layer points (t,[x]) of X, so that \u0393_k(X) is a retract of \u0393_k(Y).\n\nThis can be achieved, for example, if X \u2282 Z is an inclusion of metric spaces, where X is interpreted as a set of marked points, r is chosen sufficently small that r < t < t_+-2r for all layer parameters t of X, and the points of Y \u2282 Z are chosen such that d_H(X^k_dis,Y^k_dis) < r in Z^k_dis.\n\n\nThe analysis simplifies for Vietoris-Rips complexes. In that case, X and Y are the vertex sets of V_s(X) and V_s(Y), respectively, for all s. Then Lemma <ref> says that if (s,[y]) is a layer point of \u0393_0(Y) and (t,[x]) is a maximal layer point below (s+2r,[\u03b8(y)]), then s \u2264 t \u2264 s+2r. This means, for example, that every layer parameter s of \u0393_0(Y) satisfies t-2r \u2264 s \u2264 t for some layer parameter t of \u0393_0(X). Lemma <ref> and Lemma <ref> together say that the layer parameters of \u0393_0(X) and \u0393_0(Y) for the respective Vietoris-Rips systems are very tightly bound, in a predictable way.\n\n\n\n\n\n\n\n\n\u00a7 LAYER POINTS\n\n\nSuppose that X is a finite metric space and that k is a positive integer. The functor s \u21a6\u03c0_0L_s,k(X)  has a homotopy colimit \u0393_k(X) having objects (s,[x]) with [x] \u2208\u03c0_0L_s,k(X) and morphisms (s,[x]) \u2192 (t,[x]) with s \u2264 t. Here, the distance parameters s are positive real numbers, and hence members of the interval [0,\u221e].\n\nThis category \u0393_k(X) is a partially ordered set, and has the structure of a tree, and one writes (s,[x]) \u2264 (t,[y]) for its morphisms.\nThe spaces L_s,k(X) are connected for s sufficiently large, say s \u2265 R, since X is a finite set.\n\nI often write [x]_s for [x] \u2208\u03c0_0L_s,k. The path component [x]_s is a subset of the vertices of L_s,k(X). There is a relation (s,[x]) \u2264 (t,[y]) if and only if s \u2264 t and [x]_s\u2282 [y]_t as subsets of X.\n\n        A branch point in the tree \u0393_k(X) is a vertex (t,[x]) such that either of following two conditions hold:\n    \n    \n  1) there is an s_0 < t such that for all s_0\u2264 s < t there are distinct vertices (s,[x_0]) and (s,[x_1]) with (s,[x_0]) \u2264 (t,[x]) and (s,[x_1]) \u2264 (t,[x]), or\n    \n  2) there is no relation (s,[y]) \u2264 (t,[x]) with s < t.\n\nThe second condition means that the path component [x] does not have a representative in  L_s,k(X) for s < t.    \nWrite _k(X) for the subposet of \u0393_k(X), which is defined by the branch points.\n\n\nA layer point of \u0393_k(X) is a vertex (t,[x]) such that one of the following two conditions hold:\n\n\n  1) if there is a relation (s,[y]) \u2264 (t,[x]) with s < t, then [y]_s is a proper subset of [x]_t, equivalently there is a proper inequality | [y]_s| < | [x]_t| in cardinality, or\n\n  2) there is no relation  (s,[y]) \u2264 (t,[x]) with s < t.\n  \nThe layer points form a subposet \u0141_k(X) of \u0393_k(X).\n\n\n  There is a maximal finite subsequence\n  \n    0  t_1 < \u2026 < t_p\n\n  of positive real numbers t_j, which are the distances between vertices of \n    L_k,t_p(X) = L_k,\u221e(X).\n\n  The numbers t_i are the phase change numbers for the system L_\u2217,k(X). Observe that the vertices of L_k,t_i(X) and L_k,t_i+1(X) could coincide.\n\n  We can find the layer points for \u0393_k(X) by induction on i, starting with the observation that all points (t_1,[z]) are layer points. If [x] \u2208\u03c0_0L_t_i,k(X), then [x] \u2229 L_t_i-1,k(X)_0 is a disjoint union of path components [y]. This intersection could be empty, in which case (t_i,[x]) is a layer point. Otherwise, (t_i,[x]) is a layer point if all [y] \u2282 [x] \u2229 L_t_i-1,k(X)_0 satisfy | [y] | < | [x] |.\n  \n\n\n  All branch points are layer points, and so there are poset inclusions\n\n    _k(X) \u2286\u0141_k(X) \u2282\u0393_k(X).\n\n\n\n\n  Suppose that condition 1) holds for the branch point (t,[x]): there is an s_0 < t that for all s_0\u2264 s <t there are distinct points (s,[x_0]) and (s,[x_1]) such that (s,[x_i]) \u2264 (t,[x]).\n\n  If (s,[z]) \u2264 (t,[x]) then [z] is one of multiple path components [v]_s of L_s,k(X) that map to [x]_t in L_t,k(X). All such components are proper subsets of [x]_t. \n\n\nRecall that L_0,s(X) is the Vietoris-Rips complex V_s(X), and that the elements of X are the vertices of the Vietoris-Rips complex V_s(X). All complexes V_s(X) have the same vertices, namely the set  X.\n\n\nEvery layer point of \u0393_0(X) is a branch point, so that _0(X) = L_0(X).\n\n\n\nThe underlying sets of vertices for V_s(X) and V_t(X) coincide. Thus, if (t,[x]) is a layer point of \u0393_0(X) and s < t, then the collection [y] of components of V_s(X) that map to [x] in V_t(X) is non-empty and satisfies \u2294 [y]_s = [x]_t. There are multiple such summands [y]_s, since (t,[x]) is a layer point, so that all inclusions [y]_s\u2282 [x]_t are proper. In particular, there are distinct elements (s,[y]) and (s,[y']) below (t,[x]).\n\n\nSuppose that (s,[x]) and (t,[y]) are vertices of the graph \u0393_k(X). There is a unique smallest vertex (u,[z]) which is an upper bound for both (s,[x]) and (t,[y]) in \u0393_k(X). The number u is the smallest parameter (necessarily a phase change number) such that [x]_u=[y]_u in \u03c0_0L_u,k(X), and so [z]_u=[x]_u=[y]_u.\nIn this case, \none writes\n\n    (s,[x]) \u222a (t,[y]) = (u,[z]).\n\nThe vertex (u,[z]) is the least upper bound (or join) of (s,[x]) and (t,[y]).\n\nEvery finite collection of points (s_1,[x_1]), \u2026 ,(s_p,[x_p]) has a least upper bound\n\n    (s_1,[x_1]) \u222a\u2026\u222a (s_p,[x_p])\n\nin the tree \u0393_k(X). \n\nWe know from <cit.> that the least upper bound of two branch points is a branch point, and we have an analogous result for layer points:\n\n\n  The least upper bound (u,[z]) of layer points (s,[x]) and (t,[y]) is a layer  point.\n\n\n\nIf there is a number v such that s,t<v<u, then (v,[x]) and (v,[y]) are distinct because (u,[z]) is a least upper bound. This implies that L_v,k(X) has distinct path components [w] which map to [z] in \u03c0_0L_u,k(X). It follows that (u,[z]) is a branch point, and is therefore a layer point by L:emma <ref>.\n\n  Otherwise, s=u or t=u, in which case (u,[z]) = (s,[x]) or (u,[z])=(t,[y]). In either case, (u,[z]) is a layer point.\n\n\nLemma <ref> implies that every collection of layer points (s_1,[x_1]), \u2026 , (s_p,[x_p]) has a least upper bound\n\n    (s_1,[x_1]) \u222a\u2026\u222a (s_p,[x_p])\n\nin \u0141_k(X). The maximal (or terminal) element of L_k(X) is the least upper bound of all members of L_k(X).\n\nIt follows from Lemma <ref> and the corresponding result for branch points of <cit.> that the poset inclusions\n\n    _k(X) \u2286\u0141_k(X) \u2282\u0393_k(X)\n\npreserve least upper bounds.\n\n\nEvery vertex (s,[x]) of \u0393_k(X) has a unique largest layer point (t,[y]) such that (t,[y]) \u2264 (s,[x]). In this case, [y]_t = [x]_s.\n\n\n\n  There is a smallest phase change number t such that there is a relation (t,[y]) \u2264 (s,[x]) with [y]_t = [x]_s. The corresponding point (t,[y]) is a layer point, by the minimality of the phase change number t.\n\n  The point (t,[y]) is also an upper bound on the layer points below (s,[x]), since [y]_t=[x]_s: if (u,[z]) is a layer point below (s,[x]), then z \u2208 [y]_t and u \u2264 t since otherwise (u,[z]) is not a layer point.\n  \n\nThe first statement of Lemma <ref> is also a corollary of Lemma <ref>: take the least upper bound of all layer points below (s,[x]).\n\n\nThe poset inclusion \u0141_k(X) \u2282\u0393_k(X) has an inverse\n\n    max: \u0393_k(X) \u2192\u0141_k(X),\n\nup to homotopy, and \u0141 _k(X) is a strong deformation retract of \u0393_k(X).\n\n\n\nEvery vertex (s,[x]) of \u0393_k(X) has a unique maximal layer point (s_0,[x_0]) such that (s_0,[x_0]) \u2264 (s,[x]), by Lemma <ref>. Set\n\n    max(s,[x]) = (s_0,[x_0]).\n\nThe maximality condition implies that the function max preserves the ordering. The composite\nmax\u00b7\u03b1 is the identity on \u0141_k(X), and the relations (s_0,[x_0]) \u2264 (s,x) define a homotopy \u03b1\u00b7max\u2264 1 that restricts to the identity on \u0141_k(X).\n\n\n\n  Lemma 5 of <cit.> says that every (s,[x]) has a unique maximal branch point (s_1,[x_1]) such that (s_1,[x]_1) \u2264 (s,[x]). The branch point (s_1,[x_1]) is a layer point by Lemma <ref>, so that there are relations.\n  \n    (s_1,[x_1]) \u2264 (s_0,[x_0]) \u2264 (s,[x]),\n\n  which are natural in points (s,[x]) of \u0393_k(X).\n\n  It follows that the poset inclusions\n  \n    _k(X) \u2286\u0141_k(X) \u2282\u0393_k(X)\n\n  define strong deformation retractions, and that the respective contracting homotopies are compatible.\n\n  Recall from Lemma <ref> that _0(X) = \u0141_0(X), so that the discussion simplifies for Vietoris-Rips complexes.\n  \n\n\n\n\n\u00a7 STABILITY\n\n\nThe general setup for stability of degree Rips complexes is the following: we suppose given finite metric spaces X \u2282 Y such that the Hausdorff distance between the corresponding spaces X_dis^k and Y_dis^k of sets of k+1 distinct elements in X and Y respectively satisfies d_H(X^k_dis,Y^k_dis) < r, where r is a fixed non-zero positive real number.\n\nUnder these assumptions, the degree Rips stability theorem (Theorem 4 of <cit.>) says that there are homotopy commutative diagrams\n\n    L_s,k(X) [r]^\u03c3[d]_i    L_s+2r,k(X) [d]^i\n    \n        L_s,k(Y) [r]_\u03c3[ur]^\u03b8    L_s+2r,k(Y)\n\nApplying the path component functor \u03c0_0 gives commutative diagrams\n\n    \u03c0_0L_s,k(X) [r]^\u03c3[d]_i   \u03c0_0L_s+2r,k(X) [d]^i\n    \u03c0_0L_s,k(Y) [r]_\u03c3[ur]^\u03b8   \u03c0_0L_s+2r,k(Y)\n\nand there is an induced commutative diagram of hierarchies\n\n    \u0393_k(X) [r]^\u03c3[d]_i   \u0393_k(X) [d]^i\n    \u0393_k(Y) [r]_\u03c3[ur]^\u03b8   \u0393_k(Y)\n\nHere,\n\n    i((s,[x])) = (s,[i(x)]),\n       \u03c3((s,[x])) = (s+2r,[\u03c3(x)]), and\n       \u03b8((s,[y]) = (s+2r,[\u03b8(y)]).\n\n\nWrite i_\u2217: \u0141_k(X) \u2192\u0141_k(Y) for the composite poset morphism\n\n    \u0141_k(X) \u2282\u0393_k(X) \u0393_k(Y) \u0141_k(Y)\n\nThis map takes a layer point (s,[x]) to the maximal layer point below (s,[i(x)]). \n\nPoset morphisms \u03b8_\u2217: \u0141_k(Y) \u2192\u0141_k(X) and \u03c3_\u2217: \u0141_k(X) \u2192\u0141_k(X) are similarly defined, respectively, by the poset morphisms \u03b8: \u0393_k(Y) \u2192\u0393_k(X) and the shift morphism \u03c3: \u0393_k(X) \u2192\u0393_k(X).\n\n\n1) Consider the poset maps\n\n    \u0141_k(X) \u0141_k(Y) \u0141_k(X).\n\n\nIf (s,[x]) is a layer point for X, choose maximal layer points (s_0,[x_0]) \u2264 (s,[i(x)], (s_1,[x_1]) \u2264 (s_0+2r,[\u03b8(x_0)]) and (v,[y]) \u2264 (s+2r,[x]) below the respective objects.\n\nThen \u03b8_\u2217i_\u2217(s,[x]) = (s_1,[x_1]), and there is a natural relation\n\n    \u03b8_\u2217i_\u2217(s,[x]) = (s_1,[x_1]) \u2264 (v,[y]) = \u03c3_\u2217(s,[x])\n\nby a maximality argument.\nWe therefore have a homotopy of poset maps\n\n    \u03b8_\u2217i_\u2217\u2264\u03c3_\u2217: \u0141_k(X) \u2192\u0141_k(X).\n\n\n\n2) Similarly, if (t,[y]) is a layer point of Y, then\n\n    i_\u2217\u03b8_\u2217(t,[y]) \u2264\u03c3_\u2217(t,[y]),\n\ngiving a homotopy\n\n    i_\u2217\u03b8_\u2217\u2264\u03c3_\u2217: \u0141_k(Y) \u2192\u0141_k(Y).\n\n\n  \nThere are relations\n\n    (s,[x]) \u2264\u03c3_\u2217(s,[x]) \u2264 (s+2r,[x])\n\nfor branch points (s,[x]).\nIt follows that the poset map \u03c3_\u2217: \u0141_k(X) \u2192\u0141_k(X) is homotopic to the identity on \u0141_k(X).\n\n\nThe construction of the poset maps i_\u2217, \u03b8_\u2217 and \u03c3_\u2217, together with the relations (<ref>) and (<ref>), complete the construction/proof of the following result:\n\n\nSuppose that X \u2282 Y is an inclusion of finite metric spaces, and that d_H(X^k_dis,Y^k_dis) < r. Then there is a homotopy commutative diagram\n\n    L_k(X) [r]^\u03c3_\u2217[d]_i_\u2217    L_k(X) [d]^i_\u2217\n    \n      L_k(Y) [ur]^\u03b8_\u2217[r]_\u03c3_\u2217    L_k(Y)\n\nthat relates the layer posets \u0141_k(X) and \u0141_k(Y) of the spaces X and Y, respectively.\n\n\n\n\n\n  The element \u03c3_\u2217(s,[x]) = (t,[x]) is close to (s,[x]) in the sense that there are relations\n  \n    (s,[x]) \u2264 (t,[x]) \u2264 (s+2r,[x])\n\nso that\n  0 \u2264 t-s \u2264 2r. Thus, the layer points (s,[x]) and \u03b8_\u2217i_\u2217(s,[x]) have a common upper bound, namely \u03c3_\u2217(s,[x]), which is close to (s,[x]).\n\nIf (t,[y]) is a layer point of \u0393_k(Y), the layer point \u03c3_\u2217(t,[y]) \u2264 (t+2r,[y]) is similarly an upper bound for (t,[y]) and i_\u2217\u03b8_\u2217(t,[y]), and is close to (t,[y]).\n\nThe subobject of \u0141_k(X) consisting of all layer points of the form (s,[x]) as s varies has an obvious notion of distance: the distance between points (s,[x]) and (t,[x]) is | t-s |.  \n\n\n\nSuppose that\n\n    0 < t_1 < \u2026 < t_k\n\nare the phase change numbers for the system L_s,k(X). \n\nThe assumption that d_H(X^k_dis,Y^k_dis) < r forces the function\n\n    \u03c0_0L_s,k(X) \u2192\u03c0_0L_s,k(Y)\n\nto be surjective if s \u2265 r.\n\n       \n         Suppose, that y_1,y_2\u2208 Y have elements \u03b8(y_1), \u03b8(y_2) \u2208 X such that d(y_i,\u03b8(y_i)) < r. Then d(y_1,y_2) is in the interval (t-2r,t+2r), where t=d(\u03b8(y_1),\u03b8(y_2)).\n       \n\n       \n         We shall assume that t-2r > 0.\n\n         Consider the picture\n         \n    \u03b8(y_1) @-[ddrrrr] @-[d] \n    \n               y_1@-[ur] @-[r]     z_1@-[rrrr]              z_2@-[r]     y_2\n                   \u03b8(y_2) @-[u] @-[ur]\n\n         Suppose that v is the point of intersection of the lines (z_1,z_2) and (\u03b8(y_1),\u03b8(y_2)). Then\n         \n    d(\u03b8(y_1),\u03b8(y_2)) \u2265 d(z_1,z_2) = d(z_1,v) + d(v,z_2) \u2265 d(y_1,y_2) - 2r.\n\nThe assertion that d(\u03b8(y_1),\u03b8(y_2)) < d(y_1,y_2) +2r is a simple application of the triangle inequality.\n       \n\n       \nAll phase change numbers s for Y lie in intervals (t-2r,t+2r) around phase change numbers t of X.\n         \n\n       There is a finite collection of numbers t such that (t,[x]) is a layer point for \u0393_k(X). Say that such numbers t are the layer parameters for X.\nEach layer parameter is a phase change number.\n\n\n       Observe that the inclusions \u03c3: L_s,k(X) \u2286 L_t,k(X) for s \u2264 t induce inclusions [x]_s\u2282 [x]_t for all vertices x of L_s,k(X).\n\n       Recall from the proof of Lemma <ref> that the maximal layer point below (s,[x]) can be constructed by finding the smallest phase change number t such that there is a relations (t,[u]) \u2264 (s,[x]) such that [u]_t=[x]_s as subsets of X.\n\n       \n         Suppose that s < t and there are no layer points of the form (u,[x]) in \u0393_k(X), where s < u \u2264 t. Then the induced function\n         \n    \u03c3_\u2217: \u03c0_0L_s,k(X) \u2192\u03c0_0L_t,k(X)\n\n         is a bijection.\n         \n\n       \n         We can assume that L_t,k(X) \u2205, for otherwise L_s,k(X) = L_t,k(X) = \u2205.\n\n         Suppose that (t,[x]) \u2208\u0393_k(X) and that (u,[y]) is a maximal layer point with (u,[y]) \u2264 (t,[x]). Then u \u2264 s and the relations (u,[y]) \u2264 (s,[y]) \u2264 (t,[x]) force [y]_s = [x]_t. In particular, the function \u03c3_\u2217 is surjective.\n       \n         If [y_1],[y_s] \u2208\u03c0_0L_s,k(X) have the same image [x] \u2208\u03c0_0L_t,k(X), then [y_1]_s = [x]_t = [y_2]_s as subsets of X, so that [y_1] = [y_2] in \u03c0_0L_s,k(X), and so \u03c3_\u2217 is injective.\n         \n\nGiven a layer parameter t for X, write t_+ for the smallest layer parameter of X with t < t_+, and write t_- for the largest layer parameter of X with t_- < t. \n\n       \n\n  Suppose that t is a layer parameter for X such that r < t < t_+-2r.\n  Then the function\n  i : \u03c0_0L_t,k(X) \u2192\u03c0_0L_t,k(Y) is a bijection.\n\n\n\n  The diagram\n  \n    \u03c0_0L_t,k(X) [r]^-\u2245[d]_i   \u03c0_0L_t+2r,k(X) \n    \u03c0_0L_t,k(Y) [ur]_\u03b8\n\n  commutes, and the displayed function is a bijection by Lemma <ref>,\n  so the function i is injective. The surjectivity of i follows from the assumption t >r.\n\n\n\n\n\n  Suppose that (t,[x]) is a layer point of \u0393_k(X) with r < t < t_+-2r, and suppose that (s,[y]) is a maximal layer point below (t,[i(x)]) in \u0393_k(Y).\n  Then t-2r \u2264 s \u2264 t.\n  \n\n\n  Suppose that s < t-2r.\n\n  The map i_\u2217: \u03c0_0L_t,k(X) \u2192\u03c0_0L_t,k(Y) is a bijection by Lemma <ref> and i_\u2217([x]) = i_\u2217([\u03b8(y)]) = [i(x)] in \u03c0_0L_t,k(Y). It follows that there is a commutative diagram of functions\n\n    [\u03b8(y)]_s+2r[r]^-\u03c3    [x]_t[d]^i\n     \n               [y]_s[ur]^\u03b8[rr]_\u03c3^\u2245       [i(x)]_t\n\nin which the map i: [x]_t\u2192 [i(x)]_t is a monomorphism since it is a subobject of a monomorphism of vertices.\n\nThe functions i and \u03c3\u00b7\u03b8 are bijections, and so \u03c3: [\u03b8(y)]_s+2r\u2192 [x]_t_j is an epimorphism. This function \u03c3 is also a monomorphism, since it is a subobject of the monomorphism of vertices L_s+2r,k(X)_0\u2192 L_t,k(X)_0.\n\nIt follows that the function \u03c3: [\u03b8(y)]_s+2r\u2192 [x]_t is a bijection, so that (t,[x]) is not a layer point.\n\n\n  \n    Suppose that (t,[x]) is a layer point for \u0393_k(X) such that r< t < t_+-2r. Then we have\n    \n    \u03b8_\u2217i_\u2217(t,[x]) = (t,[x]).\n\n    \n\n  \n  Suppose that (s,[z]) is a maximal layer point below (t,[i(x)]) in \u0393_k(Y). Then t-2r \u2264 s \u2264 t by Lemma <ref>, so that t \u2264 s+2r \u2264 t+2r < t_+.\n\n  The layer point (t,[x]) is a maximal layer point below (t+2r,[x]), since t+2r < t_+, so that [x]_t = [x]_t+2r. The layer point \u03b8_\u2217(s,[z]) is the maximal layer point below (s+2r,[\u03b8(z)]), and the relation\n  \n    (s+2r,[\u03b8(z)]) \u2264 (t+2r,[x])\n\n  implies that \u03b8(z) \u2208 [x]_t+2r = [x]_s+2r, so that x \u2208 [\u03b8(z)]_s+2r.\n  It follows that the maximal layer point below (s+2r,[\u03b8(z)]) must also be the maximal layer point below (t+2r,[x]), which is (t,[x]). \n\n\n\nSuppose that (s,[y]) is a layer point of \u0393_k(Y), and that s < s_+-2r. Suppose that (t,[z]) is a maximal layer point below (s+2r,[\u03b8(y)]). Then s \u2264 t \u2264 s+2r.\n  \n\n\n  Suppose that t<s.\n  \n  The map \u03c3: \u03c0_0L_s,k(Y) \u2192\u03c0_0L_s+2r,k(Y) is a bijection, since \u0393_k(Y) has no layer parameters in the interval (s,s+2r], by assumption and Lemma <ref>. It follows that the map \u03b8: \u03c0_0L_s,k(Y) \u2192\u03c0_0L_s+2r(X) is a monomorphism.\n\nThen \u03b8([y])=\u03b8([i(z)] implies that [y]_s=[i(z)]_s, so the diagram\n    \n    [i(z)]_t[rr]^\u03c3[dr]^\u03b8       [y]_s[r]^\u03c3[dr]^\u03b8    [y]_s+2r\n    \n            [z]_t[u]^i[r]_\u03c3    [z]_t+2r[rr]_\u03c3       [\u03b8(y)]_s+2r[u]_i\n\n    commutes.\n\nThe commutativity of the triangle on the right implies that \u03b8: [y]_s\u2192 [\u03b8(y)]_s+2r is a monomorphism.\n\n\nThe function \u03c3: [z]_t\u2192 [\u03b8(y)]_s+2r a bijection, so\n\u03b8: [y]_s\u2192 [\u03b8(y)]_s+2r is a bijection.\n\nThe composite\n\n    [z]_t [i(z)]_t [y]_s\n\n  a bijection, so \u03c3: [i(z)]_t\u2192 [y]_s is a bijection, and it follows that (s,[y]) is not a layer point.\n\n\n\n  The analysis of the morphism\n\n    \u03b8_\u2217: V(Y) = \u0141_0(Y) \u2192\u0141_0(X) = V(X)\n\nfor Vietoris-Rips complexes is sharper, because all complexes V_s(Y) share the same set of vertices, namely Y. In this case, we have a stronger version of Lemma <ref>, with a very different argument.\n\n\n         Suppose that (s,[y]) is a layer point of \u0393_0(Y), and that (t,[z]) is a maximal layer point of \u0393_0(X) below (s+2r,[\u03b8(y)]). Then s \u2264 t \u2264 s+2r.\n         \n\n\n\n\n  The sets [z]_t and [\u03b8(y)]_s+2r have the same cardinality, and so \u03b8(y) \u2208 [z]_t.\n\n       Consider the collection of elements [u] \u2208\u03c0_0V_t-2r(Y) which map to [z]_t = [\u03b8(y)]_t in \u03c0_0V_t(X).\n       Then \u03b8^-1([z]_t) = \u2294 [u] as a subset of the vertices Y of V_t-2r(Y), and y \u2208 [u] for some [u]. All such components [u] map to the same path component [y]_t in V_t(X).\n\n       In the diagram\n       \n    \u03b8^-1([z]_t) [r] [d]\n                  \u03b8^-1([\u03b8(y)]_s+2r) [r] [d]     Y [d]^\u03b8\n    \n                     [z]_t[r]_\u2245    [\u03b8(y)]_s+2r[r]     X\n\nboth squares are pullbacks, so\n       the function\n       \n    \u03b8^-1([z]_t) \u2192\u03b8^-1([\u03b8(y)]_s+2r\n\n       is a bijection. \n       \n       Suppose that t < s. Then\n       \n    \u03b8^-1([z]_t) = \u2294 [u] \u2282 [y]_t\u2282 [y]_s\u2282\u03b8^-1([\u03b8(y)]_s+2r)\n\nwhile       \n\u03b8^-1([z]_t) = \u03b8^-1([\u03b8(y)]_s+2r) as subsets of Y.\n\nIt follows that [y]_t = [y]_s, so that (s,[y]) is not a layer point.\n\n\n\n  Lemma <ref> and Lemma <ref> together impose rather tight constraints on the layer points of \u0393_0(Y), in relation to those of \u0393_0(X). Recall that the comparison \u0393_0(X) \u2192\u0393_0(Y) arises from applying path component functors to the comparison V_\u2217(X) \u2192 V_\u2217(Y). In this case, d_H(X,Y)=r is the bound on Hausdorff distance which leads to the interleaving diagrams (<ref>), (<ref>) and (<ref>).\n\n  To repeat the statement of Lemma <ref>, suppose that (s,[y]) is a layer point for \u0393_0(Y), and suppose that (t,[x]) is a maximal layer point below (s+2r,[\u03b8(y)]). Then s \u2264 t \u2264 s+2r.\n\n  It follows, in particular, that all layer points of \u0393_0(Y) are in the intervals [t-2r,t] corresponding to layer points (t,[x]) of \u0393_0(X).\n\n\nclusters\n\n\nplain\n\n\n\n\n\n\n"}